<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>提额红包功能 | requirementDoc</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/chenyou-doc/assets/css/0.styles.4f7a1b45.css" as="style"><link rel="preload" href="/chenyou-doc/assets/js/app.c29e9de0.js" as="script"><link rel="preload" href="/chenyou-doc/assets/js/2.6b05d56a.js" as="script"><link rel="preload" href="/chenyou-doc/assets/js/60.ae169ae8.js" as="script"><link rel="prefetch" href="/chenyou-doc/assets/js/10.6e7e9da4.js"><link rel="prefetch" href="/chenyou-doc/assets/js/100.f2c68982.js"><link rel="prefetch" href="/chenyou-doc/assets/js/101.a5169525.js"><link rel="prefetch" href="/chenyou-doc/assets/js/102.9903e131.js"><link rel="prefetch" href="/chenyou-doc/assets/js/103.af2b4e01.js"><link rel="prefetch" href="/chenyou-doc/assets/js/104.c0b9c925.js"><link rel="prefetch" href="/chenyou-doc/assets/js/105.a5409a30.js"><link rel="prefetch" href="/chenyou-doc/assets/js/106.33a18a19.js"><link rel="prefetch" href="/chenyou-doc/assets/js/107.919f2747.js"><link rel="prefetch" href="/chenyou-doc/assets/js/108.b7eb6a0a.js"><link rel="prefetch" href="/chenyou-doc/assets/js/109.57815788.js"><link rel="prefetch" href="/chenyou-doc/assets/js/11.6e7d2dfa.js"><link rel="prefetch" href="/chenyou-doc/assets/js/12.1b5d3592.js"><link rel="prefetch" href="/chenyou-doc/assets/js/13.0972b48e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/14.2857b4af.js"><link rel="prefetch" href="/chenyou-doc/assets/js/15.3d9776a6.js"><link rel="prefetch" href="/chenyou-doc/assets/js/16.c13adbce.js"><link rel="prefetch" href="/chenyou-doc/assets/js/17.6ab318b5.js"><link rel="prefetch" href="/chenyou-doc/assets/js/18.4e449282.js"><link rel="prefetch" href="/chenyou-doc/assets/js/19.63e640a5.js"><link rel="prefetch" href="/chenyou-doc/assets/js/20.33cdf76d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/21.5426484f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/22.3c720f7f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/23.09152325.js"><link rel="prefetch" href="/chenyou-doc/assets/js/24.5fcd48a9.js"><link rel="prefetch" href="/chenyou-doc/assets/js/25.2b7c4c79.js"><link rel="prefetch" href="/chenyou-doc/assets/js/26.61e1343e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/27.c993f8f0.js"><link rel="prefetch" href="/chenyou-doc/assets/js/28.5f82ae1c.js"><link rel="prefetch" href="/chenyou-doc/assets/js/29.dda30517.js"><link rel="prefetch" href="/chenyou-doc/assets/js/3.54de6ea7.js"><link rel="prefetch" href="/chenyou-doc/assets/js/30.6ade5ac8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/31.a9bcf09f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/32.e9e27508.js"><link rel="prefetch" href="/chenyou-doc/assets/js/33.778e9804.js"><link rel="prefetch" href="/chenyou-doc/assets/js/34.13e25655.js"><link rel="prefetch" href="/chenyou-doc/assets/js/35.d30aff02.js"><link rel="prefetch" href="/chenyou-doc/assets/js/36.7a734694.js"><link rel="prefetch" href="/chenyou-doc/assets/js/37.756a9e59.js"><link rel="prefetch" href="/chenyou-doc/assets/js/38.36b6b005.js"><link rel="prefetch" href="/chenyou-doc/assets/js/39.db6934b9.js"><link rel="prefetch" href="/chenyou-doc/assets/js/4.58d2b906.js"><link rel="prefetch" href="/chenyou-doc/assets/js/40.3aaca102.js"><link rel="prefetch" href="/chenyou-doc/assets/js/41.0b48f541.js"><link rel="prefetch" href="/chenyou-doc/assets/js/42.3d275df5.js"><link rel="prefetch" href="/chenyou-doc/assets/js/43.8289236e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/44.3c59c81e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/45.39cc7fd8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/46.e5df814f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/47.68874cb5.js"><link rel="prefetch" href="/chenyou-doc/assets/js/48.2307627f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/49.15794204.js"><link rel="prefetch" href="/chenyou-doc/assets/js/5.eab2ebf7.js"><link rel="prefetch" href="/chenyou-doc/assets/js/50.bd57ede1.js"><link rel="prefetch" href="/chenyou-doc/assets/js/51.0abbdc4d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/52.38ecea1d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/53.da9c88a9.js"><link rel="prefetch" href="/chenyou-doc/assets/js/54.ccfead70.js"><link rel="prefetch" href="/chenyou-doc/assets/js/55.788e0110.js"><link rel="prefetch" href="/chenyou-doc/assets/js/56.3cba8816.js"><link rel="prefetch" href="/chenyou-doc/assets/js/57.e29a923f.js"><link rel="prefetch" href="/chenyou-doc/assets/js/58.aa403e16.js"><link rel="prefetch" href="/chenyou-doc/assets/js/59.f6f65172.js"><link rel="prefetch" href="/chenyou-doc/assets/js/6.3b96e85d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/61.3949a9ed.js"><link rel="prefetch" href="/chenyou-doc/assets/js/62.fb3b147d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/63.c2fa4de6.js"><link rel="prefetch" href="/chenyou-doc/assets/js/64.23b39bd6.js"><link rel="prefetch" href="/chenyou-doc/assets/js/65.80f21097.js"><link rel="prefetch" href="/chenyou-doc/assets/js/66.9db302fe.js"><link rel="prefetch" href="/chenyou-doc/assets/js/67.65c3e54e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/68.a8dd6ccf.js"><link rel="prefetch" href="/chenyou-doc/assets/js/69.5a775de8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/7.c080a4a0.js"><link rel="prefetch" href="/chenyou-doc/assets/js/70.2676f398.js"><link rel="prefetch" href="/chenyou-doc/assets/js/71.fc9bc680.js"><link rel="prefetch" href="/chenyou-doc/assets/js/72.f0b2b7c8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/73.31f6eef4.js"><link rel="prefetch" href="/chenyou-doc/assets/js/74.7c46cea8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/75.d0c29f52.js"><link rel="prefetch" href="/chenyou-doc/assets/js/76.daf4ba10.js"><link rel="prefetch" href="/chenyou-doc/assets/js/77.964e3404.js"><link rel="prefetch" href="/chenyou-doc/assets/js/78.91fcf053.js"><link rel="prefetch" href="/chenyou-doc/assets/js/79.ef93ac14.js"><link rel="prefetch" href="/chenyou-doc/assets/js/8.bed330a9.js"><link rel="prefetch" href="/chenyou-doc/assets/js/80.74ef2d2e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/81.e86c65c8.js"><link rel="prefetch" href="/chenyou-doc/assets/js/82.b630d28a.js"><link rel="prefetch" href="/chenyou-doc/assets/js/83.e110640d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/84.298811a3.js"><link rel="prefetch" href="/chenyou-doc/assets/js/85.718f8c91.js"><link rel="prefetch" href="/chenyou-doc/assets/js/86.c1fd5682.js"><link rel="prefetch" href="/chenyou-doc/assets/js/87.933c4d17.js"><link rel="prefetch" href="/chenyou-doc/assets/js/88.1722a15d.js"><link rel="prefetch" href="/chenyou-doc/assets/js/89.e1d8d004.js"><link rel="prefetch" href="/chenyou-doc/assets/js/9.825e9384.js"><link rel="prefetch" href="/chenyou-doc/assets/js/90.87f0b6c3.js"><link rel="prefetch" href="/chenyou-doc/assets/js/91.a4ae4c10.js"><link rel="prefetch" href="/chenyou-doc/assets/js/92.ae211ccf.js"><link rel="prefetch" href="/chenyou-doc/assets/js/93.cf036059.js"><link rel="prefetch" href="/chenyou-doc/assets/js/94.b37e5f10.js"><link rel="prefetch" href="/chenyou-doc/assets/js/95.677dc2b1.js"><link rel="prefetch" href="/chenyou-doc/assets/js/96.ce6fbdd1.js"><link rel="prefetch" href="/chenyou-doc/assets/js/97.e69b4015.js"><link rel="prefetch" href="/chenyou-doc/assets/js/98.f6711e1e.js"><link rel="prefetch" href="/chenyou-doc/assets/js/99.70d8d86e.js">
    <link rel="stylesheet" href="/chenyou-doc/assets/css/0.styles.4f7a1b45.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/chenyou-doc/" class="home-link router-link-active"><!----> <span class="site-name">requirementDoc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>服务端2020-5-11</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/chenyou-doc/server/2020-5-11/appHomeGuide.html" class="sidebar-link">首页</a></li><li><a href="/chenyou-doc/server/2020-5-11/taskDetail.html" class="sidebar-link">任务赚详情页修改</a></li><li><a href="/chenyou-doc/server/2020-5-11/invitePrize.html" class="sidebar-link">任务清单邀请奖励</a></li><li><a href="/chenyou-doc/server/2020-5-11/withdrawOption.html" class="sidebar-link">金币提现页面</a></li><li><a href="/chenyou-doc/server/2020-5-11/withdrawH5.html" class="sidebar-link">提现接口</a></li><li><a href="/chenyou-doc/server/2020-5-11/growRedPack.html" class="sidebar-link">提额红包功能</a></li><li><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html" class="active sidebar-link">提额红包功能（参考）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#获取红包信息" class="sidebar-link">获取红包信息</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#获取任务信息" class="sidebar-link">获取任务信息</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_3-完成任务" class="sidebar-link">3. 完成任务</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_4-提额" class="sidebar-link">4. 提额</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_5-领取红包" class="sidebar-link">5. 领取红包</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_6-预约红包" class="sidebar-link">6. 预约红包</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_7-游戏赚回调→完成任务" class="sidebar-link">7. 游戏赚回调→完成任务</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_8-任务赚审核通过→完成任务" class="sidebar-link">8. 任务赚审核通过→完成任务</a></li><li class="sidebar-sub-header"><a href="/chenyou-doc/server/2020-5-11/growRedPackUnused.html#_8-豹趣小游戏关闭→完成任务" class="sidebar-link">8. 豹趣小游戏关闭→完成任务</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="提额红包功能"><a href="#提额红包功能" class="header-anchor">#</a> 提额红包功能</h1> <h2 id="获取红包信息"><a href="#获取红包信息" class="header-anchor">#</a> 获取红包信息</h2> <p><strong>需求类型：</strong></p> <ul><li>新增接口</li></ul> <p><strong>相关系统参数</strong></p> <ul><li>参数名：growRedPackBase</li> <li>说明：提额红包的基础配置</li> <li>内容示例：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;base&quot;:&quot;0.3&quot;,
    &quot;taskType&quot;:[
        &quot;18&quot;,&quot;19&quot;,&quot;11&quot;,&quot;01&quot;,&quot;20&quot;,&quot;21&quot;,&quot;22&quot;,&quot;23&quot;
    ],
    &quot;18&quot;:{
        &quot;totalNum&quot;:6,
        &quot;count&quot;:[
            300,600,1200,300,600
        ],
        &quot;sequence&quot;:7,
        &quot;icon&quot;:&quot;http:i.shihuowang.com/ui/123.png&quot;,
        &quot;title&quot;:&quot;看视频打卡提额&quot;,
        &quot;extraNumDesc&quot;:&quot;今日还可打卡次数&quot;,
        &quot;prizeDesc&quot;:&quot;可提 0.02 ~ 0.3 元&quot;,
        &quot;btDesc&quot;:&quot;马上提额&quot;,
        &quot;showNum&quot;:1,
        &quot;isCount&quot;:1,
        &quot;emphasis&quot;:1,
        &quot;minAmount&quot;:&quot;0.01&quot;,
        &quot;maxAmount&quot;:&quot;0.02&quot;,
        &quot;param&quot;:{
            &quot;id&quot;:&quot;941212470&quot;
        }
    }
}
</code></pre></div><ul><li>参数说明：</li></ul> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:left;">子参数</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">base</td> <td style="text-align:left;"></td> <td style="text-align:left;">string</td> <td style="text-align:left;">红包的基础值</td></tr> <tr><td style="text-align:left;">taskType</td> <td style="text-align:left;"></td> <td style="text-align:left;">array</td> <td style="text-align:left;">要显示的任务类型</td></tr> <tr><td style="text-align:left;">18</td> <td style="text-align:left;"></td> <td style="text-align:left;">json</td> <td style="text-align:left;">任务类型，18 打卡 ； 19 首页点击赚钱；11 看视频；01 豹趣小游戏；20 推啊互动；21 打开日历事项提醒；23 打开推送</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">totalNum</td> <td style="text-align:left;">int</td> <td style="text-align:left;">每天任务可进行的总次数</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">count</td> <td style="text-align:left;">array</td> <td style="text-align:left;">每次打卡后的间隔时间 / 每次玩小游戏需要玩的时间，单位：秒</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">sequence</td> <td style="text-align:left;">int</td> <td style="text-align:left;">排序，数值越小，返回任务列表越靠前</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">icon</td> <td style="text-align:left;">string</td> <td style="text-align:left;">任务的图标</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">title</td> <td style="text-align:left;">string</td> <td style="text-align:left;">任务标题</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">extraNumDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">任务次数描述</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">prizeDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">奖励描述</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">btDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">按钮文字</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">showNum</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否显示总次数和剩余次数，0 不显示，1 显示</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">isCount</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否需要倒计时，0 不需要，1 需要</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">emphasis</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否重点显示，1表示要重点显示，0 表示不重点显示</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">minAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">提额的范围最小值</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">maxAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">提额的范围最大值</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">param</td> <td style="text-align:left;">json</td> <td style="text-align:left;">客户端跳转需要的相关参数</td></tr></tbody></table> <p><strong>新建表</strong></p> <ul><li>下文说明使用的表名：user_grow_pkg_line</li> <li>说明：用户提额的记录表，记录用户提额的记录</li> <li>下文说明所需字段：</li></ul> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">uid</td> <td style="text-align:left;">int</td> <td style="text-align:left;">用户标识</td></tr> <tr><td style="text-align:left;">taskType</td> <td style="text-align:left;">string</td> <td style="text-align:left;">任务类型，18 打卡 ； 19 首页点击赚钱；11 看视频；01 豹趣小游戏；20 推啊互动；21 打开日历事项提醒；22 关注公众号 ；23 打开推送</td></tr> <tr><td style="text-align:left;">createOn</td> <td style="text-align:left;">datetime</td> <td style="text-align:left;">提额时间</td></tr> <tr><td style="text-align:left;">money</td> <td style="text-align:left;">double</td> <td style="text-align:left;">提额金额</td></tr> <tr><td style="text-align:left;">status</td> <td style="text-align:left;">int</td> <td style="text-align:left;">提额记录的状态：0 已完成未领取；1 已领取；2 未完成，主要用于小游戏时长不够</td></tr> <tr><td style="text-align:left;">time</td> <td style="text-align:left;">int</td> <td style="text-align:left;">已进行的时长，单位：秒，主要用于记录小游戏玩的时长</td></tr></tbody></table> <p><strong>新增字段</strong></p> <ul><li>表名：user_checkin_line</li> <li>新增字段名：reserved</li> <li>说明：表示用户是否预约明天的提额红包，0表示未预约，1表示已预约</li></ul> <p><strong>请求参数</strong>
登录状态获取用户标识uid</p> <p><strong>返回示例</strong></p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;base&quot;:&quot;0.3&quot;,
   &quot;videoNum&quot;:1,
   &quot;unLockNum&quot;:3,
   &quot;videoTaskNum&quot;:1
   &quot;checkStatus&quot;:0,
   &quot;gameStatus&quot;:0,
   &quot;today&quot;:{
       &quot;status&quot;:1,
       &quot;amount&quot;:&quot;0.3&quot;
   },
   &quot;tomorrow&quot;:{
       &quot;status&quot;:0
       &quot;amount&quot;:&quot;0.7&quot;
   }
}
</code></pre></div><p><strong>返回参数说明</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">子参数名</th> <th style="text-align:left;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td style="text-align:left;">base</td> <td style="text-align:left;"></td> <td style="text-align:left;">string</td> <td>红包基数：查询系统参数 growRedPackBase 中的base</td></tr> <tr><td style="text-align:left;">videoNum</td> <td style="text-align:left;"></td> <td style="text-align:left;">int</td> <td>领取【今天红包】已看视频次数：<br>select count(1) from user_watch_video_line where reward_type = 14 and uid = #用户标识 and date(createOn)=date(now());</td></tr> <tr><td style="text-align:left;">unLockNum</td> <td style="text-align:left;"></td> <td style="text-align:left;">int</td> <td>领取【今天红包】需要看视频的次数：<br>1. 统计已看视频数：根据uid，rewar_type='14'查询user_watch_video_line 记录数<br>2. 若<code>已看视频数</code> = 0 ，则返回 1；否则返回 3</td></tr> <tr><td style="text-align:left;">videoTaskNum</td> <td style="text-align:left;"></td> <td style="text-align:left;">int</td> <td>今天看视频提额次数：<br>select count(1) from user_grow_pkg_line where taskType = '11' and uid = #用户标识 and date(createOn)=date(now()) and status = 1;</td></tr> <tr><td style="text-align:left;">checkStatus</td> <td style="text-align:left;"></td> <td style="text-align:left;">int</td> <td>打卡任务状态：<br>1. 系统参数 growRedPackBase 中的 &quot;18&quot;的 totalNum → 每天可打卡提额的总次数<br> 2. 根据 taskType= '18'，uid，date(createOn)=date(now()),status = 1 查询新表user_grow_pkg_line的记录总数 → 今天用户打卡提额次数<br>3. 根据 taskType= '18'，uid，date(createOn)=date(now()),status = 1 查询新表user_grow_pkg_line的记录中最大的createOn  →  上一次打卡时间<br>4. 查询系统参数growRedPackBase 中&quot;18&quot;的count中第<code>今天用户打卡提额次数</code>个值  → 打卡间隔 <br>判断：若<code>每天可打卡提额的总次数</code> &gt; <code>今天用户打卡提额次数</code> &amp;&amp; <code>上一次打卡时间 + 打卡间隔</code> &lt;= 当前时间 ， 即返回 0 ；否则返回 1</td></tr> <tr><td style="text-align:left;">gameStatus</td> <td style="text-align:left;"></td> <td style="text-align:left;">int</td> <td>玩小游戏任务状态：<br>1. 根据 taskType= '01'，uid，date(createOn)=date(now()),status = 1 查询新表user_grow_pkg_line的记录总数 → 今天用户玩小游戏提额次数<br>2. 查询系统参数growRedPackBase 中&quot;01&quot;的totalNum  →  每天玩小游戏提额总次数 <br> 判断：<code>今天用户玩小游戏提额次数</code> &lt; <code>每天玩小游戏提额总次数</code> 则返回 0 ，否则 返回 1</td></tr> <tr><td style="text-align:left;">today</td> <td style="text-align:left;"></td> <td style="text-align:left;">json</td> <td>【今天红包】信息 ，参数的计算逻辑见下文流程图</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">status</td> <td style="text-align:left;">string</td> <td>今天红包状态：<br>0表示 可领取<br>1 表示 已领取<br>2 表示 未预约</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">amount</td> <td style="text-align:left;">string</td> <td>今天红包的金额</td></tr> <tr><td style="text-align:left;">tomorrow</td> <td style="text-align:left;"></td> <td style="text-align:left;">json</td> <td>【明天红包】信息 ，参数的计算逻辑见下文流程图</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">status</td> <td style="text-align:left;">string</td> <td>明天红包状态：<br>0表示 不可操作<br>1 表示 可提额<br>2 表示 未预约</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">amount</td> <td style="text-align:left;">string</td> <td>明天红包的金额</td></tr></tbody></table> <p><strong>红包参数计算逻辑</strong></p> <ol><li><p>流程：
</p><div data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-05-14T04:03:17.071Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.3 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\&quot; etag=\&quot;oqayUldeNmMq7I4Vxk8N\&quot; version=\&quot;13.0.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;jbftPopOaGx1PX_JDZkn\&quot; name=\&quot;Page-1\&quot;&gt;7Vtbc+MmFP4tfeBxM7ogCT1KttNuJ51pJ51p8rSDLSJrVxaujBN7f31BAutGYjWJIjvJQ2I4AgTnnO/jHLCBPVntfs3xevkHjUgKLCPaAXsKLMu0PMQ/hGRfSnwoBXGeRKXIqATXyU8ieyrpNonIRspKEaM0Zcm6KVzQLCML1pDhPKcPzWZ3NI0agjWOSUdwvcBpV/pPErFlKUWWV8l/I0m8VG82Xb98ssKqsVzJZokj+lAT2TNgT3JKWVla7SYkFcpr6uXykaeHieUkY306XP0d/86+mn99jW++La9YuL+5yr64cm5srxZMIr5+WaU5W9KYZjidVdIwp9ssImJUg9eqNleUrrnQ5MLvhLG9NCbeMspFS7ZK5VM+4Xx/I/sXlVtRuXBUdbqrP5zuZa2cq5jgoyqQog3d5gvyxLpt6Uo4jwl7op1zMBT3cEJXhM+H98tJilly35wHlq4WH9pV1uAFaZD/YRw5yXucbuWbwMwDYQACXnAAmgDkFIVLgLjEBb4DQgPMEAhmIDBFY17wva6N05TjR9jyYZkwcr3GhbIeOISblpITIDkju6d13tWR7GBL95f4h9LjHiowmQohyxqQkDGQUlFXqZaLV2Lh2XwjPgqpYXTEoyKlAsdtAxuDI8XpiRRvTKSY5nGrzi5ByBFjFio6AduOYCPTGNNIjobOfMFlyJUs5rs6gnNBMCnoTBFc21j5kq7m283b0JmLmnyGunzmuG/IZ6ZGrS3v/qVktGwrRhvf8U+A1FR0eRwxcFRa83puVqdn2tEiu/6mdUc1raFhQwjCEKBAcF8AQeD348ci3BNxHyfHqaDIMfnRQe5p8aMGQlxjIVcmFBrzQ+DPZGzgBxxDKZ9QOM95KWaFSjoSjZm6Rjk+YEoXP/7dUkYaxnKFiD9ecfdNMmAHIhRd71r/YflRDGfMaR6RvGya0YwcHqxxFCVZXBtEja4ms2GYcccQHVTM25ouXnFOYIcWc8zTBtmIm6O+CKUdvksjgGaf2tFppwPNBuMegSdOk5gvepqSO/Y6aLU9wc11vJqerQGs2QWsORg1+lrEco8KvQMPlpp+iTJfQXum3+Q6p2du6w7FddD+qPEc7LnpQ2vUTR++g82o9jcQ0ZpHiXaxzb8tKJ+SdWlWvHwWlOt4Xh/KVbJGjGQN5Zf+OfEG2SWs1o3XbtWIvFx1EpUhuMbtyTXWqLmjpUkwWhliTjYkv+cmrAPveA55heck1cNkwbUpOCAUEEkWOA3kg1USRaXXkE3yE8+L8YRh1hzFrFi7EwJn+hTG5BWP7AwOFyt1Iz7h3o8i8otxgXxPvqS3ceRwf4r517Hc7EHv7jbcSdrGPEziBfbt3g6QVBMUfZCsvy8o4SO+8Fy7Kxc1rOY9B0LNIcqJyV6v7w1q/Y3IosjEAnTOxwnIaF0fjX2cYGlCOBl+bNY4q+Kyo2Edf32jR59oT/umZ0SA/d99lnl4Rnasf3yo0+kzDjHeuU7P7mzDQ8aF14q0XQ19+FDF483jDTgQg8DjFzbgRK4oTyCzh1bfjX3UaBtqvmTxaZ9Gw1GvW2Dfr3280xQIPvL1jCoF8hwbvSwFGj7nUc42yKVZe/+rsuMR49/2dZrlw5EDYDjAGeabXxmBwc8wrfcXUHVPLqHin9FOLqEu7z03b3yrIP/4uXo3cWrthWfkrshw+rgrcnTh/3AOq7nd/Dw/eFMYHKfmzxODD7nBmYZK+lW0pbnQf73jAl6tfv1RhsjVb2js2X8=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}" class="mxgraph" style="max-width:100%;border:1px solid transparent;"></div> <script type="text/javascript" src="https://app.diagrams.net/js/viewer.min.js"></script><p></p></li> <li><p>流程说明：</p></li></ol> <br> <table><thead><tr><th style="text-align:left;">流程</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">获取base</td> <td style="text-align:left;">查询系统参数 growRedPackBase 中的base</td></tr> <tr><td style="text-align:left;">领取红包次数</td> <td style="text-align:left;">根据 check_type = 2 ,uid 查询user_checkin_line 的记录数</td></tr> <tr><td style="text-align:left;">今天领取红包记录</td> <td style="text-align:left;">根据 check_type = 2 ,uid 查询user_checkin_line 中 date(createOn) = 今天 的记录</td></tr> <tr><td style="text-align:left;">昨天领取红包记录</td> <td style="text-align:left;">根据 check_type = 2 ,uid 查询user_checkin_line 中 date(createOn) = 昨天 的记录</td></tr></tbody></table> <h2 id="获取任务信息"><a href="#获取任务信息" class="header-anchor">#</a> 获取任务信息</h2> <p><strong>需求类型：</strong></p> <ul><li>新增接口</li></ul> <p><strong>接口说明：</strong></p> <ul><li>先查询系统growRedPackBase 中 的taskType ，得到需要返回的任务类型</li> <li>根据任务类型查询对应的参数</li> <li>将各个任务类型的json组合成array返回</li></ul> <p><strong>请求参数：</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">uid</td> <td style="text-align:left;">int</td> <td style="text-align:left;">用户标识</td></tr> <tr><td style="text-align:left;">openCalendar</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否已开启日历提醒<br>1 表示 已开启<br>0 表示未开启</td></tr> <tr><td style="text-align:left;">openPush</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否已开启推送<br>1 表示 已开启<br>0 表示未开启</td></tr></tbody></table> <p><strong>收到请求时优先操作</strong></p> <ul><li>若客户端传的openCalendar = 1 ，则下文接口不返回 taskType = '21' 的 任务信息;<br>检查user_grow_pkg_line 表中是否有该uid对应的taskType= '21' 的记录，没有则进行以下 2步操作
<ul><li>新增记录：
<ul><li>uid 为 当前用户uid</li> <li>taskType= '21'</li> <li>createOn 为 当前时间</li> <li>status = 1</li> <li>money：查询系统参数growRedPackBase 中&quot;21&quot;中的minAmount和maxAmount，组成闭区间，在闭区间内随机取值，不小于0.01，只能有 2 位小数</li></ul></li> <li>提额：update user_checkin_line set next_coin = next_coin + <code>#(上一步的money*100)</code> where date(createOn)=date(now()) and check_type = 2 and uid = #用户标识</li></ul></li> <li>若客户端传的openPush = 1，则下文接口不返回 taskType= '23' 的任务信息；<br>检查user_grow_pkg_line 表中是否有该uid对应的taskType= '23' 的记录，没有则进行以下 2步操作
<ul><li>新增记录：
<ul><li>uid 为 当前用户uid</li> <li>taskType= '23'</li> <li>createOn 为 当前时间</li> <li>status = 1</li> <li>money：查询系统参数growRedPackBase 中&quot;21&quot;中的minAmount和maxAmount，组成闭区间，在闭区间内随机取值，不小于0.01，只能有 2 位小数</li></ul></li> <li>提额：update user_checkin_line set next_coin = next_coin + <code>#(上一步的money*100)</code> where date(createOn)=date(now()) and check_type = 2 and uid = #用户标识</li></ul></li></ul> <p><strong>返回示例</strong></p> <div class="language- extra-class"><pre class="language-text"><code>[{
   &quot;icon&quot;:&quot;http:i.shihuowang.com/ui/123.png&quot;,
   &quot;title&quot;:&quot;看视频打卡提额&quot;,
   &quot;extraNumDesc&quot;:&quot;今日还可打卡次数&quot;,
   &quot;prizeDesc&quot;:&quot;可提 0.02 ~ 0.3 元&quot;,
   &quot;btDesc&quot;:&quot;马上提额&quot;,
   &quot;showNum&quot;:1,
   &quot;totalNum&quot;:6,   
   &quot;extraNum&quot;:1,
   &quot;isCount&quot;:1,
   &quot;count&quot;:123456,
   &quot;status&quot;:&quot;1&quot;,
   &quot;taskType&quot;:&quot;18&quot;,
   &quot;emphasis&quot;:1,
   &quot;param&quot;:{
       &quot;id&quot;:&quot;941212470&quot;
   }
},{
   &quot;icon&quot;:&quot;http:i.shihuowang.com/ui/123.png&quot;,
   &quot;title&quot;:&quot;首页“点击赚钱”做任务&quot;,
   &quot;extraNumDesc&quot;:&quot;完成任务提额，次数不限&quot;,
   &quot;prizeDesc&quot;:&quot;可提 0.03~0.5 元&quot;,
   &quot;btDesc&quot;:&quot;马上提额&quot;,
   &quot;showNum&quot;:0,
   &quot;status&quot;:1,
   &quot;taskType&quot;:&quot;19&quot;,
   &quot;emphasis&quot;:1,
   &quot;param&quot;:{}
}]
</code></pre></div><p><strong>返回参数说明</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">icon</td> <td style="text-align:left;">string</td> <td style="text-align:left;">图标 ：把任务类型作为 key 查询系统参数growRedPackBase  中 icon</td></tr> <tr><td style="text-align:left;">title</td> <td style="text-align:left;">string</td> <td style="text-align:left;">粗体标题 ：把任务类型作为 key 查询系统参数growRedPackBase  中 title；<br><br>！！！注意：若taskType='01'，需要用<code>游戏要求时长</code>替换title中的 <code>%s</code><br>游戏要求时长：<br>1. 根据 taskType= '01'，uid，date(createOn)=date(now()),status = 1 查询新表user_grow_pkg_line的记录总数 → 今天用户玩小游戏提额次数<br>2. 查询系统参数growRedPackBase 中&quot;01&quot;的count中第<code>今天用户玩小游戏提额次数 + 1</code>个值，由于取到的值单位为秒，需要转换为 分钟，再替换 title中的<code>%s</code></td></tr> <tr><td style="text-align:left;">extraNumDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">：把任务类型作为 key 查询系统参数growRedPackBase  中 extraNumDesc</td></tr> <tr><td style="text-align:left;">prizeDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">：把任务类型作为 key 查询系统参数growRedPackBase  中 prizeDesc</td></tr> <tr><td style="text-align:left;">btDesc</td> <td style="text-align:left;">string</td> <td style="text-align:left;">任务状态为 0 时，按钮显示的文字 ：把任务类型作为 key 查询系统参数growRedPackBase  中 btDesc</td></tr> <tr><td style="text-align:left;">showNum</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否显示“总共可领次数”和“剩余可领次数” ：把任务类型作为 key 查询系统参数growRedPackBase  中 showNum</td></tr> <tr><td style="text-align:left;">totalNum</td> <td style="text-align:left;">int</td> <td style="text-align:left;">总共可领次数 ：把任务类型作为 key 查询系统参数growRedPackBase  中 totalNum</td></tr> <tr><td style="text-align:left;">extraNum</td> <td style="text-align:left;">int</td> <td style="text-align:left;">剩余可领次数：<br>1. 统计该任务类型已提额的次数：根据taskType，uid，date(createOn)=date(now()) ,status = 1 查询新表user_grow_pkg_line的记录数<br>剩余可领次数 = totalNum - <code>该任务类型已提额的次数</code></td></tr> <tr><td style="text-align:left;">count</td> <td style="text-align:left;">int</td> <td style="text-align:left;">倒计时剩余时间，单位：秒：<br>1. 把任务类型作为 key 查询系统参数growRedPackBase  中 isCount，若 = 0，则返回 0 ；<br>2. 统计该任务类型已提额的次数：根据taskType，uid，date(createOn)=date(now()) ,status = 1 查询新表user_grow_pkg_line的记录数；<br>3. 查询count 中的第<code>该任务类型已提额的次数</code>个值，作为下次提额需要的间隔时间，单位：秒<br>4. 查询上一次该任务类型提额的时间：根据taskType，uid，date(createOn)=date(now()) ,status = 1 查询新表user_grow_pkg_line中最大的createOn；<br>5. 倒计时剩余时间 = <code>间隔时间</code> - （当前时间 - <code>上一次该任务类型提额的时间</code>）,若&lt;0,则返回 0</td></tr> <tr><td style="text-align:left;">status</td> <td style="text-align:left;">int</td> <td style="text-align:left;">状态：0 未完成；1 可领取 ； 2 倒计时中 ； 3 明天再来 <br>见下文【任务状态说明】</td></tr> <tr><td style="text-align:left;">emphasis</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否显示底色：把任务类型作为 key 查询系统参数growRedPackBase  中 emphasis</td></tr> <tr><td style="text-align:left;">param</td> <td style="text-align:left;">json</td> <td style="text-align:left;">相关的参数：把任务类型作为 key 查询系统参数growRedPackBase  中 param，不用管json中包含什么，直接返回param</td></tr></tbody></table> <p><strong>任务状态说明</strong></p> <ol><li><p>流程
</p><div data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-05-14T08:36:31.916Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.3 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\&quot; etag=\&quot;x-xybIZoUPU02Oc-Ge81\&quot; version=\&quot;13.0.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;XEIIvDT-c8jBjhwaod4E\&quot; name=\&quot;Page-1\&quot;&gt;5VpLk5s4EP41OiYF4iUdsY2zh2ztbM1hd46y0Ri2sOUFeWzn129LCDAGbGczHpxKaqoiNXrA191fP2aQM10fvuRsm/wuYp4hbMUH5MwQxjYOCPynJMdSQl0jWOVpXIqsRvCcfuNmZyXdpTEvjKwUSSEymW7bwqXYbPhStmQsz8W+vexVZHFLsGUr3hE8L1nWlf6VxjIppQQHjfw3nq6S6mbbp+WTNasWmy8pEhaL/YnIiZAzzYWQ5Wh9mPJMgdfGZT7wtH6xnG/kLRvwvxnFy2TO44X9x+5P/uI+4U+2+Y5CHqsv5jEAYKYil4lYiQ3LokY6ycVuE3N1rAWzZs1XIbYgtEH4D5fyaLTJdlKAKJHrzDwt71QXDX6LERVily/5pQ/wjFGwfMXlpYV+jTkYKxdrLvMjbMx5xmT61n4TZqxmVa9rgIWBwfZ7cDav+caynbkKRR4iBIUuinxEfRTOUOSiyUT9qEchCm0UBWow8dUaYiFid9WVZeALSi37JJX8ecs0XntwxzboLEtXGxgvAWOe11p447nkh8t66KJmNmDjzMa5XVxO942n2JX5JydeQqx7wUy7MGOfrRUUm0Wx1V9t5iupZmqN1Qc8KGSOyFxJQEUh1Y/mSqhUMUcUdlEUYkRnSks0RMQ1WlLnwPapOYd6aGJ19XZ/NwMl5se/1f7PXjV9McfpyezQmh3N7D3d07/VPcmY7lkdfGI3PAOnGlVpLZU1GnwgpWH8g0ozW59ECu9Ys4pbufGxirbtE8r3MpvONF+/xQ+QiN/L1ZMATXCf81919TwR68WuuE7R78HIFr5KyZ7/kZRMOmgWkkmAA3hXs68DlJwpMl7kMCppWWFJEIna9AvYa7wB9dDrwtxyvTGiYRXrDPZ24N0WD/17gY/dXlOGVAPQhQEFwyW/aGjC+FaWc0YNTX1sBOkK0b7wCLocRSfeqDrBQ5ymQFT5ZJ0Q6sQSUsqGx7oBBIqASMUNFWRmKoaMGUDcMxIbPYDgbgA5cQCq7B7uViD6vfXRr0Fmt5bBZeNiLMdxrB5dPoIKR1EFHZXD+joSOusKddELDAXa6CpH5WEWotjQlsl7A9WjGJO2fOd6K+JDacvBI1MRpc5ZBRlcqyH17InnKUCgkuJSeEjlCbnB7KW6DMbNSWpyD2ajH8Vs/cUoxS5A2fxrm1md4n9Qbeo4Xa8danBlTYPL6i7qsc2vbMGzK2WSctJ0ybLQPFincVyaLi/Sb2yhz1MmsFUQaFC8CfJml7zc9O7NZlSXUafmcsHHBjnhk/U5oIHxw/9rBtUS8fpa8PvotIeJLzYtb9PmTxQxb3Vxxx01YvY0l1U0pDqtd3XuTi/Fx2ZA9cAdNWISN3isiIm73HbWKbL7OkV1W17XU8Q3EtqTj4zdIHKdgegxXoMouIa5NdCdm6KwrGojRKa6qiUqZ3w4zP3Khh8Gc6fblDvDHA/Y+RCv6Go4nD0e+Lblt7sJXg/JvBP4MG1+mV7G5uZPEpzoPw==&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}" class="mxgraph" style="max-width:100%;border:1px solid transparent;"></div> <script type="text/javascript" src="https://app.diagrams.net/js/viewer.min.js"></script><p></p></li> <li><p>流程说明</p></li></ol> <br> <table><thead><tr><th style="text-align:left;">流程</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">已提额次数</td> <td style="text-align:left;">根据taskType，uid，date(createOn)=date(now()) ,status = 1 查询新表user_grow_pkg_line的记录数</td></tr> <tr><td style="text-align:left;">任务每天可提额的总次数</td> <td style="text-align:left;">把任务类型作为 key 查询系统参数growRedPackBase  中 totalNum</td></tr> <tr><td style="text-align:left;">status=0 的今天提额记录</td> <td style="text-align:left;">根据taskType，uid，date(createOn)=date(now()) ,status = 0 查询新表user_grow_pkg_line的记录</td></tr> <tr><td style="text-align:left;">是否需要倒计时</td> <td style="text-align:left;">把任务类型作为 key 查询系统参数growRedPackBase  中 isCount</td></tr> <tr><td style="text-align:left;">剩余倒计时时间</td> <td style="text-align:left;">同上一点 count</td></tr></tbody></table> <h2 id="_3-完成任务"><a href="#_3-完成任务" class="header-anchor">#</a> 3. 完成任务</h2> <p><strong>需求类型</strong></p> <ul><li>新增接口</li></ul> <p><strong>请求参数：</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">uid</td> <td style="text-align:left;">int</td> <td style="text-align:left;">用户标识</td></tr> <tr><td style="text-align:left;">taskType</td> <td style="text-align:left;">int</td> <td style="text-align:left;">任务类型</td></tr> <tr><td style="text-align:left;">isFinish</td> <td style="text-align:left;">int</td> <td style="text-align:left;">是否直接提额，0 不直接提额； 1 直接提额</td></tr></tbody></table> <p><strong>操作说明</strong></p> <ol><li>在user_grow_pkg_line 表中新增记录：
<ol><li>uid 为 当前用户uid</li> <li>taskType 为客户端传的taskType</li> <li>createOn 为 当前时间</li> <li>status 为客户端传的 isFinish</li> <li>money：将客户端传的taskType 作为 key 查询系统参数growRedPackBase 中的minAmount和maxAmount，组成闭区间，在闭区间内随机取值，不小于0.01，只能有 2 位小数</li></ol></li> <li>若 isFinish = 1 ，需要进行以下 2 步操作：
<ol><li>提额：update user_checkin_line set next_coin = next_coin + <code>#(上一步的money*100)</code> where date(createOn)=date(now()) and check_type = 2 and uid = #用户标识</li> <li>返回 提额的金额（money），提额后的金额（next_coin/100）给客户端</li></ol></li></ol> <p><strong>返回示例</strong></p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;prizeAmount&quot;:&quot;0.02&quot;,
   &quot;nowAmount&quot;:&quot;0.32&quot;
}
</code></pre></div><p><strong>返回参数说明</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">prizeAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">本次提额金额 ： 提额的金额（新增记录时计算的money）</td></tr> <tr><td style="text-align:left;">nowAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">当前红包金额  ：提额后的 next_coin/100 （由于原本是金币，所以需要除以100，以字符串返回）</td></tr></tbody></table> <h2 id="_4-提额"><a href="#_4-提额" class="header-anchor">#</a> 4. 提额</h2> <p><strong>需求类型</strong></p> <ul><li>新增接口</li></ul> <p><strong>请求参数：</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">uid</td> <td style="text-align:left;">int</td> <td style="text-align:left;">用户标识</td></tr> <tr><td style="text-align:left;">taskType</td> <td style="text-align:left;">int</td> <td style="text-align:left;">任务类型</td></tr></tbody></table> <p><strong>操作说明</strong></p> <ol><li>根据uid，taskType ，date（createOn)=date(now()),status = 0 查询 user_grow_pkg_line 的记录，将createOn最大的一条记录status 修改为 1</li> <li>提额：update user_checkin_line set next_coin = next_coin + <code>#(上一步修改的记录的money*100)</code> where date(createOn)=date(now()) and check_type = 2 and uid = #用户标识</li> <li>返回 提额的金额（money），提额后的金额（next_coin/100）给客户端</li></ol> <p><strong>返回示例</strong></p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;prizeAmount&quot;:&quot;0.02&quot;,
   &quot;nowAmount&quot;:&quot;0.32&quot;
}
</code></pre></div><p><strong>返回参数说明</strong></p> <table><thead><tr><th style="text-align:left;">参数名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">prizeAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">本次提额金额 ： 提额的金额（修改的记录的money）</td></tr> <tr><td style="text-align:left;">nowAmount</td> <td style="text-align:left;">string</td> <td style="text-align:left;">当前红包金额  ：提额后的 next_coin/100 （由于原本是金币，所以需要除以100，以字符串返回）</td></tr></tbody></table> <h2 id="_5-领取红包"><a href="#_5-领取红包" class="header-anchor">#</a> 5. 领取红包</h2> <p><strong>需求类型</strong></p> <ul><li>新增接口</li></ul> <p><strong>操作说明</strong></p> <ol><li><p>流程
</p><div data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-05-14T10:19:25.201Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.3 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\&quot; etag=\&quot;PO8sAdDUYP6US36HKrAO\&quot; version=\&quot;13.0.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;2cW0so2pr6jiRF97L81o\&quot; name=\&quot;Page-1\&quot;&gt;5Vpdj9o4FP0t++DHjmLn+zGB0K7USiuNVtv2zRBDskowMmGA/vq1HYfEJKTpDBBmOw8z9sF2nOt7zz2+AzAn+eEjw5vkC41JBpARH4A5BQi5ls9/C+BYArbtlMCKpXEJGTXwnP4gJQgrdJfGZKuwEioozYp0o4MLul6TRaFhmDG614ctaRZrwAavSAt4XuCsjf6TxkVSoh5ya/wTSVdJ9WToqBfOcTVYvck2wTHdNyAzAuaEUVqUrfwwIZmwnW6X2YVPTxtjZF0MmfAlzNl3YvyJ6fJvmM8XaDlZfjDV3opj9cIk5u+vupQVCV3RNc6iGg0Z3a1jIlY1eK8e85nSDQchB/8lRXFUh4l3BeVQUuSZ+rR8pnjQxVdR0Jbu2IL07L9yCcxWpOgZh04G545KaE4KduTzGMlwkb7o+8DKZVancbVVeUMZ9heMrNZ9wdlOPQlEPggQ8BwQ2cCbAZ83XBAGAhTIBHg2iDwQzEDogsgBIQQeap9VlvE4EGeyT9KCPG+wNNaeR2KXxV8IK8ih3+ZtG6kJlnIVFceOCuN9HRSw8vSkERCecSOj2m2jjuDK3Hjs+FXMf7Kr7je1nOxMD1rvqHrXDAF7YAxYY8aA23FcDs6Fn67nW/HnD2maM/A3PVM08Ei9Nx6pmvoXTfkO61C3oBbr0HD0Jcp9qVlnjnHaxut9BXXwpS2IMESCJn3OjqFkR1cyqKRSHwqa9Pkwo+UzLKH5fLe9C02epvTwZCWB7sKTsMOav2dQWQODCrpjEqXV4fyOEAjcsUUUhEImdIiFtqDgARJVs6YiNFpxoR3qHSSEbWmxgQw0TEQ4NwuOLmnWsLYglqiXcx7eyJY7UKndzMj+uHyjsU1NPhf4hhzS4mu1Bm83ZvFePUl0bsBR3lCOsq+R+QPG8LExYCMy+rZHGJhID2DTbHrHT8dXQqL2pnIHV1UPVeWgR2pKtCKfM7/8jOck030JZ+lqzdsLfpyEcUAEaLrAWaA+yNM4Lt2WbNMfeC7XE56hDMoXt0NgT/siXBUw1GRwKhs0vehyeF2kgw/Gk4dsVzuG6kL6WplYDaHL5ZbcRAHCUeoSb+WMmie+NRjkcTjjQuK4UxGkQ9h03AD/J0FZOnBfVEITOXpUmo8elV6HWLKEIvUCKZYsEPjv96YGfbMtlO57VeuoaXHjeZEsAvYUCn3gudKupYGnDydCR9eg0BkoCh6sAvVrieiKSWVoBeo6QrSlHE3XfTIaP9068rRg+TqtglRrWRue30BNfaEbV7ZgB4WO4F9X9BPovw/10VF/7rjoO5JjDcGxXnmtf/j7vTl+EcXvsC03VyRMJwTCDARQyoEQhJY0Mv/Ilg0f8KzLG8FEjEdOxjcbzhlvrUQLRDMQ8hznyXV4KpzKHBeIxFf+e8yD8vhcuY4tzk6MKWe1Cw+jH1a1p9EOC3Xdjt83A7lDGejCTfmNqeo8p5gOuk5yshxby4FnO3t1quLd+lsH5fD6qxtm9B8=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}" class="mxgraph" style="max-width:100%;border:1px solid transparent;"></div> <script type="text/javascript" src="https://app.diagrams.net/js/viewer.min.js"></script><p></p></li> <li><p>流程说明</p></li></ol> <table><thead><tr><th style="text-align:left;">流程</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">已看视频数</td> <td style="text-align:left;">根据uid，rewar_type='14'查询user_watch_video_line 记录数</td></tr> <tr><td style="text-align:left;">今天已看视频数</td> <td style="text-align:left;">根据reward_type = '14'，uid，date(createOn)=date(now()) 查询 user_watch_video_line 表 中的记录数</td></tr> <tr><td style="text-align:left;">获取红包金额</td> <td style="text-align:left;">根据uid，check_type = 2，date(createOn)=date(date_sub(now(),interval 1 day)) 查询 user_checkin_line 表中的next_coin , 除以 100</td></tr> <tr><td style="text-align:left;">新建红包领取记录</td> <td style="text-align:left;">在user_checkin_line中新增记录：<br>    uid 为用户标识<br>    idx = 0<br>    cur_coin 为上一步的next_coin（保持金币，不除以100）<br>    next_coin 为 查询系统参数growRedPackBase 中的base ，乘以 100 <br>    createOn为当前时间<br>    check_type = 2<br>    tid为null<br>    reserved = 0</td></tr> <tr><td style="text-align:left;">新增提现记录</td> <td style="text-align:left;">在fn_withdrawal_record中新增记录：<br>    uid 为用户标识<br>    user_account 为用户手机<br>    withdrawal_money和receive_money 为 <code>获取红包金额</code><br>    handler_money = 0 <br>    withdrawal_time 和 add_time 为当前时间<br>    withdrawal_type = 2 <br>    status = 1<br>    invalid_flag=0<br>    account_type = '03'<br>    advance_pay=0</td></tr> <tr><td style="text-align:left;">微信直接打款（不验证姓名）</td> <td style="text-align:left;">1. 根据<code>获取红包金额</code> ，使用微信企业付款到零钱，打款到用户的微信，不验证姓名<br>2. 若打款成功，修改上一步新增的fn_withdrawal_record记录：<br>    status 修改为 3<br>    check_user_id = 0<br>    check_user_account = 'system'<br>    receive_time 为当前时间<br>    receive_pay_no 为微信回调的回执<br>3. 若打款失败，将fn_withdrawal_record记录 的status 修改为  4</td></tr> <tr><td style="text-align:left;">新增看视频记录</td> <td style="text-align:left;">在user_watch_video_line 表中新增记录：<br>    uid 为当前用户标识<br>    user_account 为当前用户的手机号<br>    check_id:若新增红包领取记录，则为新增的user_checkin_line记录的id；若没走新增红包领取记录，则为 0 <br>    createOn为当前时间<br>    reward_type = '14'</td></tr></tbody></table> <h2 id="_6-预约红包"><a href="#_6-预约红包" class="header-anchor">#</a> 6. 预约红包</h2> <p><strong>需求类型</strong></p> <ul><li>新增接口</li></ul> <p><strong>操作说明</strong>
update user_checkin_line set reserved = 1 where date(createOn)=date(now()) and check_type = 2 and uid = #用户标识</p> <h2 id="_7-游戏赚回调→完成任务"><a href="#_7-游戏赚回调→完成任务" class="header-anchor">#</a> 7. 游戏赚回调→完成任务</h2> <p><strong>需求类型</strong></p> <ul><li>原接口后新增操作</li></ul> <p><strong>接口</strong></p> <ul><li>多游：<code>http://www.shihuowang.com/api/dy-pwall/callback</code></li> <li>享玩：<code>http://www.shihuowang.com/api/xw-pwall/callback</code></li></ul> <p><strong>操作说明</strong>
执行上文第 3 个 接口【完成任务】<br>
传参：taskType = '19';isFinish = 0</p> <h2 id="_8-任务赚审核通过→完成任务"><a href="#_8-任务赚审核通过→完成任务" class="header-anchor">#</a> 8. 任务赚审核通过→完成任务</h2> <p><strong>需求类型</strong></p> <ul><li>原接口后新增操作</li></ul> <p><strong>接口</strong></p> <ul><li>管理后台任务审核接口：<code>/app-task/user-attend/audit</code> 需要前端传 status = '03',表示审核通过</li> <li>移动端任务管理后台审核接口：<code>/my/seller-app-task/audit</code>需要前端传 status = '03',表示审核通过</li></ul> <p><strong>操作说明</strong>
执行上文第 3 个 接口【完成任务】<br>
传参：taskType = '19';isFinish = 0</p> <h2 id="_8-豹趣小游戏关闭→完成任务"><a href="#_8-豹趣小游戏关闭→完成任务" class="header-anchor">#</a> 8. 豹趣小游戏关闭→完成任务</h2> <p><strong>需求类型</strong></p> <ul><li>原接口后新增操作</li></ul> <p><strong>接口</strong></p> <ul><li>管理后台任务审核接口：<code>/api/little-game/callback</code> 无论传</li></ul> <p><strong>操作说明</strong></p> <ol><li><p>流程
</p><div data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-05-14T11:14:17.609Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.3 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\&quot; etag=\&quot;9t8FgF_QWNsh-Md1boEL\&quot; version=\&quot;13.0.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;vgxLtz8AvesaW2gzkEBG\&quot; name=\&quot;Page-1\&quot;&gt;5VhLb6MwEP41PrbijTmShGwPrbRSDts9rZzgAluII3CapL9+x2BCHMhjNyJUWimK7M8eY2bmmwfIHGfbbzlZxS8spCkytHCLzAkyDFt34V8AuwowsVUBUZ6EFaQ1wCz5pBWo1+g6CWkhsQrijKU8Wanggi2XdMEVjOQ526jb3lgaKsCKRLQFzBYkbaM/kpDHFYoNt8GfaBLF9ZN1x6tWMlJvlm9SxCRkmwPIDJA5zhnj1SjbjmkqdKfqZXpidX+xnC75NQLB+9jg1mY2/fi1efIK8vK+2DyY8m58V78wDeH95ZTlPGYRW5I0aNBRztbLkIpTNZg1e54ZWwGoA/ibcr6TxiRrzgCKeZbKVbhwvnuV8uXkp5g82vV0sj1cnOzkrLqruOBJFUioYOt8Qc+8d+1KJI8oP7PP2BsKHJyyjMJ9QC6nKeHJh3oPIl0t2u9rrAEDaZC/MI4894Oka/kkFNhopCE8RYGDRlj8YIBxidgIw6qJAg95LvJhv5PCu43mOYwiMUIBLsXNUipAvl1KTZHf4QdpChwT9t7ECaezFSkVugGWq9aUl6Q5p9vzdmnrUQqYTiUhY4RlVNNNQzi9ZlF8QDas9aR4u1PxoFEPi4E3Rj4eljgNV34qVOmdOMaVxLEGJY7WYUBLsAVPvpolBwuB11qyyuA3mFKKfmcJXHHPecvACumxoZ5Q3UsKHfnD/hb/7iJGh4c4pT/4pYcECI9lbPU0FLjI8xGULgKZloiHfAN5ExFSYTNEVRGawa/sljvlMcvm6+IukdTQrIuh1HbuGErd/5Rd1rXsOmHPW9ll6oofmNaRgXuml9WdQYExQVly+MjXSsK5aOSUFQuwZ9qmjuIJd6CP7ilq0+tu5VIp4vTFH70dT74wgeg24a/1GTA+kIJZIyQmfVT115b1+rB1vdNmh+GQTPjzcl6sSqXIeVW3iz0lXyApYVcmKMhIlxkk9PpM5tCUKwYmaRItYbwAHdMcAEGbBNpeXy5kSRhWvkSL5JPMy/OEuVYiZJQasUfInpzjnezJpTDad8KHpj3j9CdZ+qA9utpRopMNzI1h03AfXb3r3PoI9vZW0F4ipt7V7bVqi7oQ4UlGBy00LF3Vv+4OXWnoXSVdu5KDNmAkfjIL6W0t3jnnOI59lHOubH/7yznesDlnsOa2/ljZf9V2m33cDk+HTODIUCHLrDPtzOWe5c4ksExTIYHdHwdg2nx0raJ38+XaDP4A&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}" class="mxgraph" style="max-width:100%;border:1px solid transparent;"></div> <script type="text/javascript" src="https://app.diagrams.net/js/viewer.min.js"></script><p></p></li> <li><p>流程说明</p></li></ol> <table><thead><tr><th style="text-align:left;">流程</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">未完成的提额记录</td> <td style="text-align:left;">根据uid，taskType = '01'，status= 2，date(createOn)=date(now())查询user_grow_pkg_line 的 createOn最大的一条记录</td></tr> <tr><td style="text-align:left;">增加时长</td> <td style="text-align:left;">将客户端传的时长，添加到查询到的记录的time</td></tr> <tr><td style="text-align:left;">新增未完成记录</td> <td style="text-align:left;">新增user_grow_pkg_line记录：  <br>     uid 为 当前用户uid<br>    taskType = '01'<br>    createOn 为 当前时间<br>    status = 2<br>    money：查询系统参数growRedPackBase 中&quot;01&quot;中的minAmount和maxAmount，组成闭区间，在闭区间内随机取值，不小于0.01，只能有 2 位小数<br>    time为客户端传的时长</td></tr> <tr><td style="text-align:left;">记录的time</td> <td style="text-align:left;">根据uid，taskType = '01'，status= 2，date(createOn)=date(now())查询user_grow_pkg_line 的 createOn最大的一条记录的time</td></tr> <tr><td style="text-align:left;">指定时长</td> <td style="text-align:left;">1. 统计今天玩小游戏提额成功的次数：根据uid，taskType = '01'，status= 1，date(createOn)=date(now())查询user_grow_pkg_line 的记录数<br>2. 指定时长：查询系统参数growRedPackBase 中&quot;01&quot;中的count中的第 <code>今天玩小游戏提额成功的次数 + 1</code> 个值</td></tr> <tr><td style="text-align:left;">完成任务</td> <td style="text-align:left;">根据uid，taskType = '01'，status= 2，date(createOn)=date(now())查询user_grow_pkg_line 的 createOn最大的一条记录，将status 改为 0</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/chenyou-doc/server/2020-5-11/growRedPack.html" class="prev">
        提额红包功能
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/chenyou-doc/assets/js/app.c29e9de0.js" defer></script><script src="/chenyou-doc/assets/js/2.6b05d56a.js" defer></script><script src="/chenyou-doc/assets/js/60.ae169ae8.js" defer></script>
  </body>
</html>
