(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{310:function(t,e,a){"use strict";a.r(e);var i=a(28),l=Object(i.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"任务结算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务结算"}},[t._v("#")]),t._v(" 任务结算")]),t._v(" "),a("p",[a("strong",[t._v("需求类型：")])]),t._v(" "),a("ul",[a("li",[t._v("优化")])]),t._v(" "),a("p",[a("strong",[t._v("流程：")])]),t._v(" "),a("div",{staticClass:"mxgraph",staticStyle:{"max-width":"100%",border:"1px solid transparent"},attrs:{"data-mxgraph":'{"highlight":"#0000ff","nav":true,"resize":true,"toolbar":"zoom layers lightbox","edit":"_blank","xml":"<mxfile host=\\"Electron\\" modified=\\"2020-05-11T02:40:04.641Z\\" agent=\\"5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.3 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\\" etag=\\"qOGXadBsEAxxtxbzFll-\\" version=\\"13.0.3\\" type=\\"device\\"><diagram id=\\"DwUkKljpadeGoUmyQjFo\\" name=\\"Page-1\\">5VlLc5swEP4tPejYDO/HEWzcHNJpmrTT5CgbBZQBi5FFbOfXVwJhrGBTkhS7k854xtpPWnm1u99qwcCc5JsvFBbpVxKjDBhavAHmFBiGrnkO/xLItkY8TQIJxXENaS1wi59RoynREsdoJbEaYoRkDBcquCDLJVowBYOUkrW67IFksQIUMEEd4HYBsy76C8cslacw3Ba/RDhJm1/WHb+eyWGzWJ5klcKYrPcgMwLmhBLC6lG+maBMOE/1y+zI7M4wipZsiIL5FP3E1zdPNz/C8tv38nFeXF59lrus2LY5MIr5+aVIKEtJQpYwi1o0pKRcxkjsqnGpXXNFSMFBnYOPiLGtDCYsGeFQyvJMznKD6fZO6lfCvRAu7EacbvYnp1sp1bYKA4+6oDkPKekC9ZzbkKkEaYJYzzp7Fyie4YjkiNvD9SjKIMNPqh1QplqyW7dTvSaYW2hokhaG7tUqkhSOpe5QmyWV2pDywZ4VLVQF+hVBl4d/glkpTwAiC4Sh+EQ28AIQ6CByheibYhBEwHe7mZJlnIUiI9YpZui2gJXL17wQqPGWP4coQ5v+yHU93XjMURxmSIetW0rqDc/SPTp62vHQKF59rQvNs/Bmg9ldyxQu3e/NtKQRQsOZlmstve4Vdo3ONXsg19xxuOZbSurozY10IrJZXbIZDswFRZbzVVG5WsoZE5Lwf2fFgWS7gnN+1yoJAjOcLPl4wWOEKAcE5zC/zAI5keM4rnMRrfAznFf7iXAX4viVQ+wQ2NM+0sqbViq399t+ahznzFGGf9YuPLepi2+N+S7GF5anKpGHhxUaJcD2gWrKi+gMBDMQ+SAwAM+4GvH5wAG+DUJNTHmuAF/GlqYkn5er05TVRqWnrlrOCeuqM5wtiWDLMKp8/H5maI3VnVGKrOm4vQ1NbX+nxnb2sUyrd5+Ra7V7kMo8yQSDD3VIfBBWnOaE8PRqzUx0S4LlfOxXiAfCgO/abaDUxDsB282XV+HANsoZi+5Nvf/v+Ko7Qwn73q7offE5UI///GBw6ry2LEPJa/Psae2fNa3116X1Wx4r/iYV3IFUOCsTmvzp60wEqn3Q5r1O6d7u3fLf2b2P36sbB159vAjXJzD0AWxkOp+DYscK7Ylum0P9lydaKj8UA95zeRPZUgXTf+xRyjHVFvjsj1LNEcbpZrWus09863u2+hJ1xFufi+17+roWtf92mNFv</diagram></mxfile>"}'}}),t._v(" "),a("script",{attrs:{type:"text/javascript",src:"https://app.diagrams.net/js/viewer.min.js"}}),t._v(" "),a("p",[a("strong",[t._v("请求URL：")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("/my/seller-app-task/charrenOperation")])])]),t._v(" "),a("p",[a("strong",[t._v("请求参数：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("id")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('操作标识，结算传"js"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("taskid")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("int")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("任务标识")])])])]),t._v(" "),a("p",[a("strong",[t._v("流程说明：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("流程")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("操作说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("可领取数量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1. 根据appid 查询 app_task_plan 表中的 start_time <= now() 的 release_num 总和  → 已投放份数"),a("br"),t._v(" 2. 根据appid 查询user_attend_app_line表中status = '01' 的任务记录数  → 进行中份数 "),a("br"),t._v(" 3. 已投放份数 - 进行中份数  → 可领取数量")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("修改任务状态 为 7")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 修改 app_task_info 表中的status 为 7")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("结算")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("1. 根据taskid作为id 修改 app_task_info 中的downdt 为当前时间")]),t._v(" "),a("br"),a("br"),t._v("**2. 根据 taskid作为id 查询 app_task_info 中的渠道标识 ruid ,title,seller_pay_price **"),a("br"),a("br"),a("strong",[t._v("3. 在 fn_io_record 中添加渠道的退款记录:")]),a("br"),t._v("    comment = '任务【 "),a("code",[t._v("title")]),t._v(" 】结算'，"),a("br"),t._v("    trade_type = '3065' ， "),a("br"),t._v("    money = （"),a("code",[t._v("seller_pay_price")]),t._v("/100 * 可领取份数），"),a("br"),t._v("    free_money 为（sys_user 中的 free_money) + （"),a("code",[t._v("seller_pay_price")]),t._v("/100 *  * 可领取份数） "),a("br"),a("br"),a("strong",[t._v("4. 更新结算后的用户余额 sys_user.free_money")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("进行中数量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 查询user_attend_app_line表中status = '01' 的任务记录数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("修改任务状态 为 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 修改 app_task_info 表中的status 为 0")])])])])])}),[],!1,null,null,null);e.default=l.exports}}]);