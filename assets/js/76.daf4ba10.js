(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{300:function(t,e,a){"use strict";a.r(e);var l=a(28),i=Object(l.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"超时取消任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#超时取消任务"}},[t._v("#")]),t._v(" 超时取消任务")]),t._v(" "),a("p",[a("strong",[t._v("需求类型：")])]),t._v(" "),a("ul",[a("li",[t._v("梳理")])]),t._v(" "),a("p",[a("strong",[t._v("流程：")])]),t._v(" "),a("div",{staticClass:"mxgraph",staticStyle:{"max-width":"100%",border:"1px solid transparent"},attrs:{"data-mxgraph":'{"highlight":"#0000ff","nav":true,"resize":true,"toolbar":"zoom layers lightbox","edit":"_blank","xml":"<mxfile host=\\"Electron\\" modified=\\"2020-05-08T03:59:24.445Z\\" agent=\\"5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.0.1 Chrome/80.0.3987.163 Electron/8.2.1 Safari/537.36\\" etag=\\"0QLXPJRrrZvlrnk8OpS9\\" version=\\"13.0.1\\" type=\\"device\\"><diagram id=\\"CuN40mzGRX5nShc7UWxd\\" name=\\"Page-1\\">7Vvdb+I4EP9b7sHqU1ex84HzmEC6J92etFJPd+29GeJCViFGwRTYv/7sxCGEhGK2bAy3lSphjz9iz8xvZjx2gT2cbz7nZDH7k8U0BciKN8AeAYSghT3xIynbkoItRZjmSVySrJrwmHyn1UhFXSUxXSpaSeKMpTxZNIkTlmV0whs0kuds3ez2wtK4QViQKW0RHickbVP/SWI+U7tAg5r+O02ms+rL0PPLljmpOqudLGckZus9kh0Be5gzxsvSfDOkqWReky8PR1p3C8tpxnUGLP/4K/rqjP728ni0+HfsjVn2dK9mWfJttWEai/2rKsv5jE1ZRtKopoY5W2UxlbNaolb3+cLYQhChIH6jnG+VMMmKM0Ga8XmqWstvyg8d3Uq1LrbKJ/SN9SOlEiSfUv5GP7xjuNBUyuaU51sxLqcp4clrcx1Eqcx016/mqigoxp7BZLXIV5Ku1JdAhEHoAeyCyAP+QJYjF+AH4HuSIpswiBwQhvJPNgUg6JBVmgocSJmsZwmnjwtSMGstoNjF8Veac7p5m+dtHqkBSOFW4Rg5ZXVdgwJWmj7bAwS2fhJT7TZTkUfmcuPZeCl/CgU9pBlQd8HgfPukxheVZ1n55FbV0Wa/cbRVtQvCxNOECUQmceLcknToJuFPdU9Re65mFOV6kKwYlCjyTUrUPQnS37RR+oWMRWzRkB1Jk2kmyhPBPpoLgrRwiXDegWqYJ3FcqgldJt/JuJhPSmLBkowXu3VD4I7eMpEqslCDa3++L7Xj6nzUnt5bn/AA4nIubWmo6b7K5dfG+GAAe3lZCqU4FN5uDT8uT6/Dk7W8VDSQhbDwZML847bfymdsPl4te/FbjjU46bgcr0fHNbglK3dBi4U1LZZn0mDhHwvVWgrekFcPwVllSJSS25rRmfezlNw/HZ1V9SkvatZHrLYfg+kEa65JpFQH9NuQj+FoTVumZsM1CPVhm/Jzjlg3F7xBq1sQe9EbsppGF95WLFfpZMPXFZ4teACRDwIEcNPX+S4ILdmEB5JoMqrzELquqA5q5CMOofPh9A58mY7TM5rJg86Zcc2VybcW6XNDotcjX2RWvh0JC2kBhTX0i5PuCPj+3kHALwrtvFWfphDbV3bAhR1ZgnZqVnS4s+Ddr2rvdE/DyGhGFg60RYnuPkzdmaI9kiDsSbRdqY4y2IOyEGKA7cLUjUBQJD/CAPjtQ1+fpg5aLrwyW6eR6PgI9Fr2TAcdRvOAyEh2wwifjWYc0OmMw//4hgidTDJA7DsNi6dq70wy3PeWZaj08DCjLtxMKAsBBHhYhNaiPLqyLANEnntd/gbZv6rfcHTt2XsD5mJokOdku9dBWYM2oHaa4jYTUgK4+8I+PcBzDpSjXMJlwdiRvpBAs+SfgF4wBGHURlzPl1nQ8po2D7p+G3a9Xmch1yjs4HmwM3zZgW7jbQo68pjhAQRR4YdE2dd63lB6L3E8Qlb7cr939DjK8lzNXTC6qRcPpsGjnT0wC56u7MF7wdPxUKhn8GDXanoeD5kGTzvBQLO4DSjdl8BkuSifyb8kG8nYy4TJfvMmFOE22/BlHgeLav1kvoyL6n88sKP/AA==</diagram></mxfile>"}'}}),t._v(" "),a("script",{attrs:{type:"text/javascript",src:"https://app.diagrams.net/js/viewer.min.js"}}),t._v(" "),a("p",[a("strong",[t._v("请求方式：")])]),t._v(" "),a("ul",[a("li",[t._v("计时器查询 user_attend_task_line 是否有提交超时的记录")]),t._v(" "),a("li",[t._v("提交超时的条件：\n"),a("ul",[a("li",[t._v("user_attend_task_line 的 status = '01'")]),t._v(" "),a("li",[t._v("（对应 appid 下，app_task_info 的 expire_minute（单位：分钟） + user_attend_task_line 的 createOn）>= now()")])])])]),t._v(" "),a("p",[a("strong",[t._v("请求参数：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("userid")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("int")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用户标识")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("appid")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("int")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("任务标识")])])])]),t._v(" "),a("p",[a("strong",[t._v("流程说明：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("流程")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("操作说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("超时取消")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1. 根据appid，uid 查询 user_attend_app_line 表中 status = '01' 的记录，修改status 为 '05'"),a("br"),t._v("2. 根据appid，uid 查询 user_attend_task_line 表中 status = '01' 的记录，修改status 为 '06'")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("任务状态")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 查询 app_task_info 表中的 status")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("可领取数量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1. 根据appid 查询 app_task_plan 表中的 start_time <= now() 的 release_num 总和  → 已投放份数"),a("br"),t._v(" 2. 根据appid 查询user_attend_app_line表中status = '01' 的任务记录数  → 进行中份数 "),a("br"),t._v(" 3. 已投放份数 - 进行中份数  → 可领取数量")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("剩余时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1. 根据appid 查询 app_task_info 表中的downdt → 截止时间 "),a("br"),t._v(" 2. 截止时间 - now() → 剩余时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("发布来源")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 查询 app_task_info 表中的ori_type ： 01 表示 运营发布 ； 02 表示 渠道发布")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("退款")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("1. 根据 appid 查询 app_task_info 中的渠道标识 ruid ,title,seller_pay_price")]),a("br"),t._v(" "),a("br"),a("strong",[t._v("2. 在 fn_io_record 中添加渠道的退款记录:")]),a("br"),t._v("    comment = '任务【 "),a("code",[t._v("title")]),t._v(" 】用户提交超时，任务已过期，退款'，"),a("br"),t._v("    trade_type = '3070' ， "),a("br"),t._v("    money = "),a("code",[t._v("seller_pay_price")]),t._v("/100"),a("br"),a("br"),a("strong",[t._v("3. 增加渠道的余额（sys_user 中的 free_money) + "),a("code",[t._v("seller_pay_price")]),t._v("/100")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("进行中数量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 查询user_attend_app_line表中status = '01' 的任务记录数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("修改任务状态 为 1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 修改 app_task_info 表中的status 为 1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("修改任务状态 为 7")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据appid 修改 app_task_info 表中的status 为 7")])])])])])}),[],!1,null,null,null);e.default=i.exports}}]);